<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AR Drawing Projector</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: black;
  overflow: hidden;
  font-family: system-ui;
}

#camera {
  position: fixed;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

#overlay-container {
  position: fixed;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

#overlay-img {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 60%;
  opacity: 0.6;
  pointer-events: auto;
  touch-action: none;
  cursor: grab;
}

.controls {
  position: fixed;
  bottom: 15px;
  width: 100%;
  display: flex;
  justify-content: center;
  gap: 10px;
  flex-wrap: wrap;
}

.controls button,
.controls input {
  background: rgba(0,0,0,0.7);
  color: white;
  border: 1px solid #444;
  padding: 10px 14px;
  border-radius: 10px;
}

.controls input[type="range"] {
  width: 120px;
}
</style>
</head>

<body>

<!-- Camera -->
<video id="camera" autoplay playsinline></video>

<!-- Image Overlay -->
<div id="overlay-container">
  <img id="overlay-img"/>
</div>

<!-- Controls -->
<div class="controls">
  <input type="file" id="upload" accept="image/*" />
  <label>Opacity</label>
  <input type="range" min="0.1" max="1" step="0.05" value="0.6" id="opacity">
  <button id="rotate">Rotate</button>
  <button id="lock">Lock</button>
</div>

<script>
const video = document.getElementById("camera");
const overlay = document.getElementById("overlay-img");

const upload = document.getElementById("upload");
const opacity = document.getElementById("opacity");
const rotateBtn = document.getElementById("rotate");
const lockBtn = document.getElementById("lock");

let scale = 1;
let rotation = 0;
let locked = false;

// Camera
navigator.mediaDevices.getUserMedia({
  video: { facingMode: "environment" }
})
.then(stream => video.srcObject = stream);

// Upload image
upload.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  overlay.src = URL.createObjectURL(file);
};

// Opacity
opacity.oninput = e => overlay.style.opacity = e.target.value;

// Rotate
rotateBtn.onclick = () => {
  rotation += 10;
  updateTransform();
};

// Lock
lockBtn.onclick = () => {
  locked = !locked;
  overlay.style.pointerEvents = locked ? "none" : "auto";
  lockBtn.textContent = locked ? "Unlock" : "Lock";
};

// Dragging
let isDragging = false;
let startX, startY;
let currentX = window.innerWidth/2;
let currentY = window.innerHeight/2;

overlay.addEventListener("pointerdown", e => {
  if (locked) return;
  isDragging = true;
  startX = e.clientX - currentX;
  startY = e.clientY - currentY;
  overlay.setPointerCapture(e.pointerId);
});

window.addEventListener("pointermove", e => {
  if (!isDragging) return;
  currentX = e.clientX - startX;
  currentY = e.clientY - startY;
  updateTransform();
});

window.addEventListener("pointerup", () => isDragging = false);

// Zoom with wheel
window.addEventListener("wheel", e => {
  scale += e.deltaY * -0.001;
  scale = Math.min(Math.max(0.1, scale), 5);
  updateTransform();
});

function updateTransform() {
  overlay.style.transform =
    `translate(${currentX}px, ${currentY}px) scale(${scale}) rotate(${rotation}deg)`;
}
</script>

</body>
</html>
