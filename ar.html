<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>AR Sketch Pro</title>

<link rel="manifest" href="manifest.json">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
--glass:rgba(24,24,28,.72);
--border:rgba(255,255,255,.14);
--accent:#59ffd3;
--shadow:0 20px 50px rgba(0,0,0,.6);
}

*{margin:0;padding:0;box-sizing:border-box;}

html,body{
height:100%;
background:black;
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display",Inter,system-ui;
overflow:hidden;
color:white;
}

/* CAMERA */
video,canvas{
position:fixed;
inset:0;
width:100%;
height:100%;
object-fit:cover;
}

/* ================= SPLASH ================= */
#splash{
position:fixed;
inset:0;
background:radial-gradient(circle at top,#111,#000);
display:flex;
align-items:center;
justify-content:center;
z-index:99;
animation:fadeSplash .8s ease forwards;
animation-delay:2.2s;
}

@keyframes fadeSplash{
to{opacity:0;pointer-events:none}
}

#splashBox{
text-align:center;
}

#splashBox h1{
font-size:3.2rem;
letter-spacing:-.02em;
font-weight:700;
}

#splashBox p{
opacity:.6;
margin-top:6px;
}

/* ================= OVERLAY ================= */
.layer{
position:absolute;
top:50%;
left:50%;
touch-action:none;
pointer-events:auto;
opacity:.75;
filter:drop-shadow(0 8px 30px rgba(0,0,0,.6));
}

/* ================= UI ================= */

.toolbar,.bottom{
position:fixed;
left:50%;
transform:translateX(-50%);
display:flex;
gap:10px;
padding:14px 18px;
background:var(--glass);
border:1px solid var(--border);
border-radius:22px;
backdrop-filter:blur(18px);
-webkit-backdrop-filter:blur(18px);
box-shadow:var(--shadow);
z-index:10;
}

/* Safe-area for iPhones */
.toolbar{top:calc(env(safe-area-inset-top) + 14px);}
.bottom{
bottom:calc(env(safe-area-inset-bottom) + 14px);
flex-wrap:wrap;
width:min(94%,560px);
justify-content:center;
}

/* Buttons */

button,input[type=file]{
background:rgba(255,255,255,.04);
color:white;
border:1px solid var(--border);
padding:10px 18px;
border-radius:16px;
font-weight:500;
letter-spacing:.2px;
cursor:pointer;
transition:.2s ease;
}

button:hover{
border-color:var(--accent);
color:var(--accent);
box-shadow:0 0 14px rgba(90,255,210,.35);
}

button:active{
transform:scale(.96);
}

input[type=file]{
max-width:150px;
}

/* Mobile */
@media(max-width:640px){
.toolbar,.bottom{width:95%;}
}

/* ================= GUIDES ================= */
#guide{
position:fixed;
inset:0;
border:2px dashed rgba(255,255,255,.12);
pointer-events:none;
z-index:4;
}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
  <div id="splashBox">
    <h1>AR Sketch Pro</h1>
    <p>by Silent Programmer</p>
    <p>v2.1</p>
  </div>
</div>

<video id="camera" autoplay playsinline></video>

<div id="layers"></div>

<!-- TOP -->
<div class="toolbar">
  <input type="file" id="upload" accept="image/*">
  <button id="addLayer">Ôºã Layer</button>
  <button id="torch">üî¶ Torch</button>
  <button id="calibrate">üìê Calibrate</button>
</div>

<!-- BOTTOM -->
<div class="bottom">
  <button id="warp">ü™Ñ Warp</button>
  <button id="guides">üìè Guides</button>
  <button id="lock">üîí Lock</button>
  <button id="reset">‚Ü∫ Reset</button>
</div>

<script>
setTimeout(()=>splash.remove(),2600);

/* CAMERA */
const video=document.getElementById("camera");
let stream;

navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(s=>{stream=s;video.srcObject=s});

/* TORCH */
torch.onclick=async()=>{
const track=stream?.getVideoTracks()[0];
if(!track || !track.getCapabilities().torch)
return alert("Torch not supported");

const on=track.getSettings().torch;
await track.applyConstraints({advanced:[{torch:!on}]});
};

/* LAYERS */
const layersDiv=document.getElementById("layers");
let activeLayer;

function createLayer(src){
const img=document.createElement("img");
img.src=src;
img.className="layer";
img.style.transform="translate(-50%,-50%)";
layersDiv.appendChild(img);
makeInteractive(img);
activeLayer=img;
}

upload.onchange=e=>{
const f=e.target.files[0];
if(f)createLayer(URL.createObjectURL(f));
};

addLayer.onclick=()=>upload.click();

/* INTERACTION */
let pointers=new Map(),startDist=0,startScale=1,startRot=0,startAngle=0;

function makeInteractive(el){
let x=innerWidth/2,y=innerHeight/2,scale=1,rot=0,locked=false;

function update(){
el.style.transform=
`translate(${x}px,${y}px) translate(-50%,-50%) scale(${scale}) rotate(${rot}deg)`;
}

el.onpointerdown=e=>{
if(locked)return;
pointers.set(e.pointerId,e);
el.setPointerCapture(e.pointerId);
activeLayer=el;
};

el.onpointermove=e=>{
if(!pointers.has(e.pointerId))return;
pointers.set(e.pointerId,e);

if(pointers.size===1){
x+=e.movementX;
y+=e.movementY;
update();
}

if(pointers.size===2){
const[a,b]=[...pointers.values()];
const dx=b.clientX-a.clientX;
const dy=b.clientY-a.clientY;
const dist=Math.hypot(dx,dy);
const ang=Math.atan2(dy,dx)*180/Math.PI;

if(!startDist){
startDist=dist;
startScale=scale;
startRot=rot;
startAngle=ang;
}else{
scale=startScale*(dist/startDist);
rot=startRot+(ang-startAngle);
update();
}
}
};

el.onpointerup=e=>{
pointers.delete(e.pointerId);
if(pointers.size<2)startDist=0;
};

lock.onclick=()=>locked=!locked;

reset.onclick=()=>{
x=innerWidth/2;y=innerHeight/2;
scale=1;rot=0;update();
};
}

/* GUIDES */
let guideOn=false;
guides.onclick=()=>{
guideOn=!guideOn;
if(guideOn){
const g=document.createElement("div");
g.id="guide";
document.body.appendChild(g);
}else document.getElementById("guide")?.remove();
};

/* SERVICE WORKER */
if("serviceWorker"in navigator){
navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
